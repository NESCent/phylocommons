{% extends "master.html" %}

{% block title %}Query - PhyloCommons{% endblock %}

{% block leftmenu %}
{% include "tree_menu.html" %}
{% endblock %}

{% block nav-query %}class="active"{% endblock %}

{% block content %}

<form action="{% url query %}" method="post" enctype="multipart/form-data" class="form-horizontal">
    {% csrf_token %}
    
    {{ form.non_field_errors }}
    
    <div class="control-group">
        <label class="control-label" for='q' data-original-title="A comma-delimited list of taxa to search for. Use spaces, not underscores.">
            Taxa
            <i class="icon-question-sign"></i>
        </label>
        <div class="controls">
            {{ form.taxa }}
            {{ form.taxa.errors }}
        </div>
    </div>

    <div class="control-group">
        <label class="control-label" for='tree_id' data-original-title='Choose a tree, or select "see all matching trees" to choose from matching trees later.'>
            From tree
            <i class="icon-question-sign"></i>
        </label>
        <div class="controls">
            <div class="input-prepend stretch">
            <span class="add-on">{{ tree_uri }}</span>
            {{ form.tree_id }}
            </div>
            {{ form.tree_id.errors }}
        </div>
    </div>
    
    <div class="control-group">
        <label class="control-label" for='format' data-original-title="Format of the resulting tree.">
            Result format
            <i class="icon-question-sign"></i>
        </label>
        <div class="controls">
            {{ form.format }}
            {{ form.format.errors }}
        </div>
    </div>
    
    <div class="control-group">
        <label class="control-label" for='prune' data-original-title="If not checked, return the entire tree beginning with the MRCA of the listed taxa. If checked, taxa not specified in the query will be pruned away.">
            Prune result
            <i class="icon-question-sign"></i>
        </label>
        <div class="controls">
            {{ form.prune }}
            {{ form.prune.errors }}
        </div>
    </div>
        
    <div class="control-group">
        <div class="controls">
            <a style="cursor:pointer" onclick='toggle_extra_options()'>Advanced options...</a>
        </div>
    </div>
    
    <div class="control-group advanced">
        <label class="control-label" for='taxonomy' data-original-title="Choose a taxonomy to enable synonym and/or common name matching, if available.">
            Using taxonomy
            <i class="icon-question-sign"></i>
        </label>
        <div class="controls">
            <div class="input-prepend stretch">
            <span class="add-on">{{ tree_uri }}</span>
            {{ form.taxonomy }}
            </div>
            {{ form.taxonomy.errors }}
        </div>
    </div>
        
    <div class="control-group advanced">
        <label class="control-label" for='filter' data-original-title="SPARQL triple pattern or FILTER expression used to filter resulting trees. Use the ?tree variable to refer to the potential result tree.<br/><br/>For example, to only search trees that cite a DOI: ?tree bibo:cites ?x FILTER (CONTAINS(STR(?x), 'dx.doi.org'))">
            SPARQL tree filter
            <i class="icon-question-sign"></i>
        </label>
        <div class="controls">
            {{ form.filter }}
            {{ form.filter.errors }}
        </div>
    </div>
    
    <div class="control-group">
        <div class="controls">
            <button class="btn btn-primary btn-block" type="submit">Get tree</button>
        </div>
    </div>
</form>

<script type='text/javascript'>
    $(document).ready(function() {
        $('.advanced').hide();
        $('label').tooltip({ html: true });
    });

    function toggle_extra_options() {
        $('.advanced').slideToggle();
    }
</script>

{% endblock %}
