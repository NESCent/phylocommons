{% extends "master.html" %}

{% block title %}{{tree_id}} - PhyloCommons{% endblock %}

{% block head %}
    <link rel="stylesheet" href="/static/treelib.css" type="text/css" />
    <script type="text/javascript" src="/static/jquery-svgpan.js" ></script> 
    <script type="text/javascript" src="/static/treelib.js"></script> 
{% endblock %}

{% block nav-trees %}class="active"{% endblock %}

{% block leftmenu %}
{% include "tree_menu.html" %}
{% endblock %}

{% block content %}

<p>
    <a href='/trees/'>&lt;&lt; Back to list of trees</a>
</p>

<br/><br/>

<table>
    <tr><td><strong>URI</strong></td><td>
    {{tree_uri}}
    </td></tr>
    
    <tr><td><strong>Download</strong></td><td>
    <ul>
    {% for format in formats %}
    <li><a href='/trees/{{tree_id}}/download?format={{format}}'>{{format}}</a></li>
    {% endfor %}
    </ul>
    </td></tr>
    
    <tr><td><strong>Trees</strong></td><td>
    {% if tree_info %}
    <table style='width:100%'>
    <thead><td>Tree URI</td><td>Taxa</td></thead>
        {% for uri, taxa in tree_info %}
        <tr><td>{{uri}}</td><td>{{taxa}}</td></tr>
        {% endfor %}
    </table>
    {% endif %}
    </td></tr>
</table>

{% include "treelib_widget.html" %}

<input type="hidden" name="newick" id="newick" value=""/>

<p><span id="message"><a id="treelib_load">Click here to load the tree viewer.</a></span></p>

<script type="text/javascript">
    $(document).ready(function () {
        $('div#treelib-widget').hide()
    })
    
    $('#message a').click(function() {
        $('#message').empty();
        $('#message').append('<p>Loading tree...</p>');
        
        $.ajax({
            type: "GET",
            url: "download?format=newick",
            success: function(data) {
                $('#message').empty();
                $('#newick').val(data);
                $('div#treelib-widget').show();
            },
            error: function(msg) {
                $('#message').empty();
                $('#message').append("<a>Couldn't load tree. Click here to try again.</a>");
            }
        });
    });
</script>
{% endblock %}
